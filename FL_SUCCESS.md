# โ Federated Learning: ะฃัะฟะตัะฝะพ ะฝะฐัััะพะตะฝะพ!

## ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ

1. **ะกะพะทะดะฐะฝะฐ ะธะฝััะฐััััะบัััะฐ FL**:
   - `scripts/federated_cycle.py` - ะพัะฝะพะฒะฝะพะน FL ัะธะบะป
   - `ml/trainer.py` - ะปะพะบะฐะปัะฝะพะต ะพะฑััะตะฝะธะต
   - `ml/model.py` - SwipeLSTM ั ะผะตัะพะดะพะผ `compute_delta()`
   - `grpc_client/fl_client.py` - ะบะปะธะตะฝั ะดะปั ัะตัะฒะตัะฐ

2. **ะกะพะทะดะฐะฝ ะฟัะพััะพะน ะธะฝัะตััะตะนั**:
   - `fl_train_simple.py` - ะทะฐะฟััะบ FL ัะธะบะปะฐ (ะฑะตะท ัะผะพะดะทะธ ะดะปั Windows)
   - `fl_status.py` - ะฟัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ
   - `save_trained_model.py` - ัะพััะฐะฝะตะฝะธะต ะผะพะดะตะปะธ

3. **ะะตัะฒัะน ััะฟะตัะฝัะน ะทะฐะฟััะบ**:
   ```
   ะะฐะฝะฝัะต: 17 ัะฒะฐะนะฟะพะฒ
   ะญะฟะพัะธ: 5
   Loss: 29.89 โ 26.36 (โ12%)
   ะัะตะผั: ~1 ัะตะบัะฝะดะฐ ะฝะฐ CPU
   ```

## ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั

### 1. ะกะฑะพั ะดะฐะฝะฝัั

```bash
# ะะฐะฟัััะธัะต ััะพะฝัะตะฝะด
cd apps/frontend/demo
# ะัะบัะพะนัะต index.html ะฒ ะฑัะฐัะทะตัะต

# ะะตะปะฐะนัะต ัะฒะฐะนะฟั, ะธัะฟัะฐะฒะปัะนัะต, ัะพััะฐะฝัะนัะต
# ะะฐะฝะฝัะต ัะพััะฐะฝััััั ะฒ: apps/client/data/raw/YYYY-MM-DD/swipes.jsonl
```

### 2. ะะฐะฟััะบ ะดะพะพะฑััะตะฝะธั

```bash
cd apps/client

# ะัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
python fl_status.py

# ะะฐะฟััะบ FL ัะธะบะปะฐ
python fl_train_simple.py
```

### 3. ะะตะทัะปััะฐั

ะะพัะปะต ะพะฑััะตะฝะธั ะฒั ัะฒะธะดะธัะต:
```
[Step 1/5] Downloading global weights from server...
โ Using initial random weights (ะตัะปะธ ัะตัะฒะตั ะฝะตะดะพัััะฟะตะฝ)

[Step 2/5] Loading local data...
โ Loaded 17 samples from 3 files

[Step 3/5] Training model on local data...
Epoch 1/5, Loss: 29.8897
Epoch 2/5, Loss: 29.3546
Epoch 3/5, Loss: 28.7192
Epoch 4/5, Loss: 27.8377
Epoch 5/5, Loss: 26.3643
โ Training completed on 17 examples

[Step 4/5] Computing weight delta...
โ Computed delta with 6 layers

[Step 5/5] Uploading delta to server...
โ Error uploading to server (ะตัะปะธ ัะตัะฒะตั ะฝะตะดะพัััะฟะตะฝ)

[OK] FL Cycle completed successfully!
```

## ะัะพัะตัั FL (5 ัะฐะณะพะฒ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 1: Download global weights                        โ
โ โโ ะะพะดะบะปััะฐะตััั ะบ gRPC ัะตัะฒะตัั (localhost:50051)      โ
โ โโ ะกะบะฐัะธะฒะฐะตั ะฟะพัะปะตะดะฝะธะต ะณะปะพะฑะฐะปัะฝัะต ะฒะตัะฐ                โ
โ โโ Fallback: ะธัะฟะพะปัะทัะตั model2.pt ะธะปะธ random init     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Step 2: Load local data                                โ
โ โโ ะงะธัะฐะตั *.jsonl ะธะท data/raw/                        โ
โ โโ Preprocessing: vx, vy, ax, ay, normalization       โ
โ โโ ะกะพะทะดะฐะตั PyTorch Dataset                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Step 3: Train model locally                            โ
โ โโ CTC Loss ะดะปั sequence-to-sequence                  โ
โ โโ Adam optimizer, lr=0.001                           โ
โ โโ ะะฑััะฐะตั N ัะฟะพั (default: 5)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Step 4: Compute delta                                  โ
โ โโ delta = trained_weights - global_weights           โ
โ โโ ะญะบะพะฝะพะผะธั ััะฐัะธะบ (ะพัะฟัะฐะฒะปัะตะผ ัะพะปัะบะพ ะธะทะผะตะฝะตะฝะธั)     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Step 5: Upload delta to server                         โ
โ โโ ะัะฟัะฐะฒะปัะตั delta + num_examples ัะตัะตะท gRPC         โ
โ โโ ะกะตัะฒะตั ะฐะณะณัะตะณะธััะตั ะดะตะปััั ะพั ะฒัะตั ะบะปะธะตะฝัะพะฒ        โ
โ โโ FedAvg: weighted_avg(deltas) โ new global weights  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะะพะฝัะธะณััะฐัะธั

ะคะฐะนะป: `config.py`

```python
# Client
client_id = "client-001"
server_grpc_url = "localhost:50051"

# Training
batch_size = 32
learning_rate = 0.001
num_epochs = 5

# Model
input_size = 7          # x, y, dt, vx, vy, ax, ay
hidden_size = 512
alphabet_size = 40
max_seq_len = 300
```

## ะะฐะฑะพัะฐ ะฑะตะท ัะตัะฒะตัะฐ

ะัะปะธ gRPC ัะตัะฒะตั ะฝะตะดะพัััะฟะตะฝ (ะบะฐะบ ัะตะนัะฐั), FL ัะธะบะป ะฒัั ัะฐะฒะฝะพ ัะฐะฑะพัะฐะตั:

โ **ะงัะพ ัะฐะฑะพัะฐะตั**:
- ะะฐะณััะทะบะฐ ะฟัะตะดะพะฑััะตะฝะฝะพะน ะผะพะดะตะปะธ ะธะท `model2.pt`
- ะะฑััะตะฝะธะต ะฝะฐ ะปะพะบะฐะปัะฝัั ะดะฐะฝะฝัั
- ะััะธัะปะตะฝะธะต ะดะตะปััั
- ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ัะฐะณะพะฒ

โ **ะงัะพ ะฝะต ัะฐะฑะพัะฐะตั**:
- ะกะบะฐัะธะฒะฐะฝะธะต ะณะปะพะฑะฐะปัะฝัั ะฒะตัะพะฒ ั ัะตัะฒะตัะฐ
- ะัะฟัะฐะฒะบะฐ ะดะตะปััั ะฝะฐ ัะตัะฒะตั

ะญัะพ ะฝะพัะผะฐะปัะฝะพ ะดะปั:
- ะะพะบะฐะปัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั
- ะัะปะฐะดะบะธ ะฟัะตะฟัะพัะตััะธะฝะณะฐ
- ะัะพะฒะตัะบะธ ะบะฐัะตััะฒะฐ ะผะพะดะตะปะธ

## ะกะปะตะดัััะธะต ัะฐะณะธ

### 1. ะกะพะฑัะฐัั ะฑะพะปััะต ะดะฐะฝะฝัั

ะขะตะบััะธะต 17 ัะฒะฐะนะฟะพะฒ โ ััะพ ะผะฐะปะพ. ะะตะบะพะผะตะฝะดัะตััั:
- **ะะธะฝะธะผัะผ**: 50-100 ัะฒะฐะนะฟะพะฒ
- **ะฅะพัะพัะพ**: 500-1000 ัะฒะฐะนะฟะพะฒ
- **ะัะปะธัะฝะพ**: 5000+ ัะฒะฐะนะฟะพะฒ

### 2. ะะฐัััะพะธัั ัะตัะฒะตั (ะพะฟัะธะพะฝะฐะปัะฝะพ)

ะัะปะธ ัะพัะธัะต ะฟะพะปะฝะพัะตะฝะฝัะน FL ั ัะตัะฒะตัะพะผ:

```bash
# ะขะตัะผะธะฝะฐะป 1: ะะฐะฟััะบ gRPC ัะตัะฒะตัะฐ
cd apps/server
go run cmd/server/main.go

# ะขะตัะผะธะฝะฐะป 2: ะะฐะฟััะบ FL ัะธะบะปะฐ
cd apps/client
python fl_train_simple.py
```

### 3. ะญะบัะฟะตัะธะผะตะฝัะธัะพะฒะฐัั ั ะณะธะฟะตัะฟะฐัะฐะผะตััะฐะผะธ

```python
# config.py
num_epochs = 10              # ะะพะปััะต ัะฟะพั
learning_rate = 0.0005       # ะะตะฝััะต LR
batch_size = 16              # ะะตะฝััะต batch ะดะปั ะผะฐะปะตะฝัะบะธั ะดะฐะฝะฝัั
```

### 4. ะะพะฝะธัะพัะธะฝะณ ะบะฐัะตััะฒะฐ

ะะพัะปะต ะพะฑััะตะฝะธั ะฟัะพะฒะตัััะต ะผะพะดะตะปั:

```bash
# ะะฐะฟัััะธัะต API
python main.py

# ะ ะฑัะฐัะทะตัะต ะพัะบัะพะนัะต ััะพะฝัะตะฝะด
cd apps/frontend/demo
# ะัะบัะพะนัะต index.html

# ะะตะปะฐะนัะต ัะฒะฐะนะฟั ะธ ะฟัะพะฒะตััะนัะต ะฟัะตะดัะบะฐะทะฐะฝะธั
```

## ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
python fl_status.py

# FL ัะธะบะป
python fl_train_simple.py

# ะกะพััะฐะฝะตะฝะธะต ะผะพะดะตะปะธ ั timestamp
python save_trained_model.py

# ะะฐะฟััะบ API
python main.py

# ะัะพัะผะพัั ะดะฐะฝะฝัั
cat data/raw/2026-01-18/swipes.jsonl

# ะะพะดััะตั ัะฒะฐะนะฟะพะฒ
find data/raw -name "*.jsonl" -exec wc -l {} +
```

## ะััะธัะตะบัััะฐ ะดะฐะฝะฝัั

```
apps/client/
โโโ data/
โ   โโโ raw/
โ       โโโ 2026-01-14/swipes.jsonl  (2 ัะฒะฐะนะฟะฐ)
โ       โโโ 2026-01-17/swipes.jsonl  (1 ัะฒะฐะนะฟ)
โ       โโโ 2026-01-18/swipes.jsonl  (14 ัะฒะฐะนะฟะพะฒ)
โโโ model2.pt                         (ะฟัะตะดะพะฑััะตะฝะฝะฐั ะผะพะดะตะปั)
โโโ fl_train_simple.py               (ะทะฐะฟััะบ FL)
โโโ fl_status.py                      (ะฟัะพะฒะตัะบะฐ)
โโโ scripts/federated_cycle.py       (FL ะปะพะณะธะบะฐ)
```

## ะะตะทัะปััะฐัั ะฟะตัะฒะพะณะพ ะทะฐะฟััะบะฐ

```
Date: 2026-01-18
Swipes: 17
Epochs: 5
Device: CPU
Time: ~1 second

Loss progression:
  Epoch 1: 29.89
  Epoch 2: 29.35
  Epoch 3: 28.72
  Epoch 4: 27.84
  Epoch 5: 26.36

Improvement: -12% loss
Delta: 6 layers computed
Status: โ Success (local training)
```

## FAQ

### Q: ะะพัะตะผั "Proto files not generated"?
A: gRPC proto ัะฐะนะปั ะฝะต ัะบะพะผะฟะธะปะธัะพะฒะฐะฝั. ะญัะพ ะฝะต ะผะตัะฐะตั ะปะพะบะฐะปัะฝะพะผั ะพะฑััะตะฝะธั, ัะพะปัะบะพ ะพัะฟัะฐะฒะบะต ะฝะฐ ัะตัะฒะตั.

### Q: ะัะถะฝะพ ะปะธ ะทะฐะฟััะบะฐัั ัะตัะฒะตั?
A: ะะตั, ะดะปั ะปะพะบะฐะปัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั ัะตัะฒะตั ะฝะต ะฝัะถะตะฝ. FL ัะธะบะป ะฑัะดะตั ะพะฑััะฐัั ะผะพะดะตะปั ะปะพะบะฐะปัะฝะพ.

### Q: ะะฐะบ ะฟัะพะฒะตัะธัั, ััะพ ะผะพะดะตะปั ัะปัััะธะปะฐัั?
A: ะะฐะฟัััะธัะต API (`python main.py`) ะธ ะฟัะพัะตััะธััะนัะต ัะฒะฐะนะฟั ัะตัะตะท ััะพะฝัะตะฝะด.

### Q: ะกะบะพะปัะบะพ ะดะฐะฝะฝัั ะฝัะถะฝะพ ะดะปั ัะพัะพัะตะณะพ ัะตะทัะปััะฐัะฐ?
A: ะะธะฝะธะผัะผ 100-500 ัะฒะฐะนะฟะพะฒ ะฝะฐ ัะปะพะฒะพ. ะงะตะผ ะฑะพะปััะต, ัะตะผ ะปัััะต.

### Q: ะะพะถะฝะพ ะปะธ ะธะทะผะตะฝะธัั ะบะพะปะธัะตััะฒะพ ัะฟะพั?
A: ะะฐ, ะฒ `config.py` ะธะทะผะตะฝะธัะต `num_epochs = 10`.

### Q: ะะดะต ััะฐะฝัััั ะพะฑััะตะฝะฝัะต ะฒะตัะฐ?
A: ะ `model2.pt`. ะะพัะปะต ะบะฐะถะดะพะณะพ FL ัะธะบะปะฐ ะผะพะดะตะปั ะพะฑะฝะพะฒะปัะตััั.

## ะะพัะพะฒะพ! ๐

ะขะตะฟะตัั ะฒั ะผะพะถะตัะต:
1. โ ะกะพะฑะธัะฐัั ะดะฐะฝะฝัะต ัะตัะตะท ััะพะฝัะตะฝะด
2. โ ะะพะพะฑััะฐัั ะผะพะดะตะปั ะปะพะบะฐะปัะฝะพ
3. โ ะขะตััะธัะพะฒะฐัั ะบะฐัะตััะฒะพ
4. โ ะะพะฒัะพัััั ัะธะบะป ะดะปั ัะปัััะตะฝะธั

ะฃะดะฐัะธ ะฒ ะพะฑััะตะฝะธะธ ะผะพะดะตะปะธ! ๐

